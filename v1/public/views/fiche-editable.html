<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - Itacante</title>
    <link rel="stylesheet" href="/static/css/main.css" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="icon" type="image/png" sizes="16x16" href="/media/italogo.png">
    <script src="/static/js/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header id="id-header" class="p-3 bg-dark text-white"></header>
    <main>
        <form action="./traitement/save_fiche.php">
            <div class="container p-4">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab nav-dark" role="tablist">
                        <button class="nav-link active" id="nav-informations-principales-tab" data-bs-toggle="tab" data-bs-target="#nav-informations-principales" type="button" role="tab" aria-controls="nav-informations-principales" aria-selected="true">Informations principales</button>
                        <button class="nav-link" id="nav-competences-traits-tab" data-bs-toggle="tab" data-bs-target="#nav-competences-traits" type="button" role="tab" aria-controls="nav-competences-traits" aria-selected="false">Compétences et traits</button>
                        <button class="nav-link" id="nav-equipement-tab" data-bs-toggle="tab" data-bs-target="#nav-equipement" type="button" role="tab" aria-controls="nav-equipement" aria-selected="false">Equipement</button>
                        <button class="nav-link" id="nav-magie-coups-speciaux-tab" data-bs-toggle="tab" data-bs-target="#nav-magie-coups-speciaux" type="button" role="tab" aria-controls="nav-disabled" aria-selected="false">Magie et coups spéciaux</button>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-informations-principales" role="tabpanel" aria-labelledby="nav-informations-principales-tab" tabindex="0">
                        <div class="row">
                            <div class="col-12 col-md-7 order-2 order-md-1">
                                <div class="py-2 row gy-2 gx-3 align-items-center">
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <input id="id-fiche-nom" name="fiche-nom" type="text" class="form-control" placeholder="Nom de la créature" autocomplete="off" value ="" required>
                                            <label for="id-fiche-nom">Nom de la créature</label>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <select class="form-select" name="fiche-taille" id="id-fiche-taille" aria-label="Taille de la créature">
                                                <option value="">Taille de la créature</option>
                                                <option value="xxs">XXS</option>
                                                <option value="xs">XS</option>
                                                <option value="s">S</option>
                                                <option value="m">M</option>
                                                <option value="l">L</option>
                                                <option value="xl">XL</option>
                                                <option value="xxl">XXL</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <input id="id-fiche-exp" name="fiche-exp" type="number" class="form-control" placeholder="Exp" autocomplete="off" min="0" value ="0" required>
                                            <label for="id-fiche-exp">EXP</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">Royaume</th>
                                                <th scope="col" id="th-in-royaume">Peut se trouver dans ce royaume</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            <tr>
                                                <td scope="col" id="td-royaume-mezoide">Mezoïde</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-mezoide" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-mezoide">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-rocheuses">Rocheuses</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-rocheuses" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-rocheuses">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-tagata">Tagata</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-tagata" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-tagata" >
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-oland">Ôland</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-oland" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-oland">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-iles">Îles perdues</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-iles" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-iles">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-big-blue">Big Blue</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-big-blue" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-big-blue">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                            <td scope="col" id="td-royaume-desert">Désert Larmoyant</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-desert" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-desert">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-paradis">Paradis</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-paradis" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-paradis">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-enfer">Enfer</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-enfer" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-enfer">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-life">Life Lands</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-life" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-life">
                                                    </div>
                                                </td> 
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-death">Death Lands</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-death" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-death">
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-royaume-archaia">Archaia</td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input id="id-fiche-location-archaia" class="form-check-input" type="checkbox" role="switch" aria-labelledby="th-in-royaume td-royaume-archaia">
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-12 col-md-5 order-1 order-md-2">
                                <div class="row">
                                    <img id="id-fiche-image-preview" src="../" class="rounded img-fluid" alt="Image créature" style="background-color: grey; min-height:300px" accept="image/*">
                                </div>
                                <div class="row">
                                    <div class="input-group my-3">
                                        <input name="fiche-image" class="form-control" type="file" id="id-fiche-image-input" onchange="previewImage(event)" accept="image/*">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row py-2 gy-2 gx-3 align-items-center">
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-pv" name="fiche-pv" type="number" class="form-control" placeholder="Points de vie" autocomplete="off" required>
                                    <label for="id-fiche-pv">Points de vie</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-mana" name="fiche-mana" type="number" class="form-control" placeholder="Mana" autocomplete="off" required>
                                    <label for="id-fiche-mana">Mana</label>
                                </div>
                            </div>
                        </div>
                        <div class="row gy-2 gx-3 align-items-center">
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-force" name="fiche-force" type="number" class="form-control" placeholder="Force" autocomplete="off" value="10">
                                    <label for="id-fiche-force">Force</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-dexterite" name="fiche-dexterite" type="number" class="form-control" placeholder="Dextérité de la créature" autocomplete="off" value="10" required>
                                    <label for="id-fiche-dexterite">Dextérité</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-constitution" name="fiche-constitution" type="number" class="form-control" placeholder="Constitution de la créature" autocomplete="off" value="10" required>
                                    <label for="id-fiche-constitution">Constitution</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-intelligence" name="fiche-intelligence" type="number" class="form-control" placeholder="Intelligence de la créature" autocomplete="off" value="10" required>
                                    <label for="id-fiche-intelligence">Intelligence</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-sagesse" name="fiche-sagesse" type="number" class="form-control" placeholder="Sagesse de la créature" autocomplete="off" value="10" required>
                                    <label for="id-fiche-sagesse">Sagesse</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-floating">
                                    <input id="id-fiche-charisme" name="fiche-charisme" type="number" class="form-control" placeholder="Charisme de la créature" autocomplete="off" value="10" required>
                                    <label for="id-fiche-charisme">Charisme</label>
                                </div>
                            </div>
                        </div>
                        <div class="row py-2 gy-2 gx-3 align-items-center">
                            <div class="form-floating">
                                <textarea class="form-control" id="id-fiche-description" name="fiche-description" placeholder="Description" required></textarea>
                                <label for="id-fiche-description">Description</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade" id="nav-competences-traits" role="tabpanel" aria-labelledby="nav-competences-traits-tab" tabindex="0">           
                        <div class="row py-2 gy-2 gx-3 align-items-start">
                            <div class="col-12 col-md-6">
                                <h3>Compétences</h3>
                                <table id="table-traits" class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">Nom</th>
                                                <th scope="col">Description</th>
                                                <th scope="col">Bonus/Malus</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            <tr>
                                                <td scope="col">Acrobatie (DEX)</td>
                                                <td>
                                                    Un jet de Dextérité (Acrobaties) couvre votre tentative pour rester sur vos pieds dans une situation délicate, comme lorsque vous essayez de courir sur de la glace, de tenir en équilibre sur une corde raide, ou de rester debout sur le pont d'un navire chahuté. Le maître de jeu peut également demander un jet de Dextérité (Acrobaties) pour voir si vous pouvez effectuer des acrobaties, comme un plongeon, une roulade ou un saut périlleux
                                                </td>
                                                <td><input id="id-fiche-bonus-acrobatie" type="number" name="bonus-acrobatie" value="-4"></td>
                                            </tr>
                                            <tr>
                                                <td scope="col">Arcane (INT)</td>
                                                <td>
                                                    Un jet d'Intelligence (Arcanes) évalue votre aptitude à vous rappeler des choses à propos de sorts, d'objets magiques, de symboles occultes, de traditions magiques, de plans d'existence ou des habitants de ces plans.
                                                </td>
                                                <td><input id="id-fiche-bonus-arcane" type="number" name="bonus-arcane" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Atlétisme (FOR)</td>
                                                <td>
                                                    Un jet de Force (Athlétisme) couvre les situations difficiles que vous rencontrez en grimpant, en sautant ou nageant
                                                </td>
                                                <td><input id="id-fiche-bonus-athletisme" type="number" name="bonus-athletisme" value="-4"></td>
                                            </tr>
                                            <tr>
                                                <td scope="col">Discrétion (DEX)</td>
                                                <td>
                                                    Faite un jet de Dextérité (Discrétion) lorsque vous essayez de vous cacher des ennemis, de vous glisser entre des gardes, filer sans vous faire remarquer, ou vous échapper sans être vu ou entendu.                                                
                                                </td>
                                                <td><input id="id-fiche-bonus-discretion" type="number" name="bonus-discretion" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Dressage (SAG)</td>
                                                <td>
                                                Quand il est question de savoir si vous pouvez calmer un animal domestique, faire qu'une monture ne s'effraye pas, ou deviner les intentions d'un animal, le MD peut demander un jet de Sagesse (Dressage). Vous pouvez également faire un jet de Sagesse (Dressage) pour contrôler votre monture lorsque vous tentez une manœuvre risquée.
                                                </td>
                                                <td><input id="id-fiche-bonus-dressage" type="number" name="bonus-dressage" value="-4"></td>
                                            </tr>
                                            <tr>
                                                <td scope="col">Escamotage (DEX)</td>
                                                <td>
                                                    Chaque fois que vous tentez une manipulation ou une fourberie, comme prendre quelque chose à quelqu'un ou dissimuler un objet sur vous-même, faites un jet de Dextérité (Escamotage). Le MD peut également demander un jet de Dextérité (Escamotage) pour déterminer si vous pouvez dérober une bourse ou glisser quelque chose dans la poche de quelqu'un.                                                
                                                </td>
                                                <td><input id="id-fiche-bonus-escamotage" type="number" name="bonus-escamotage" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Histoire (INT)</td>
                                                <td>
                                                Un jet d'Intelligence (Histoire) évalue votre aptitude à vous rappeler des choses à propos d'événements historiques, de personnages légendaires, d'anciens royaumes, de conflits passés, de guerres récentes et de civilisations perdues.
                                                </td>
                                                <td><input id="id-fiche-bonus-histoire" type="number" name="bonus-histoire" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Intimidation (CHA)</td>
                                                <td>
                                                Lorsque vous essayez d'influencer les gens par des menaces ouvertes, des actions hostiles, ou de la violence physique, le MD peut vous demander de faire un jet de Charisme (Intimidation). Cela peut appliquer pour essayer de soutirer des informations à un prisonnier, convaincre des voyous de renoncer à une confrontation, ou utiliser un tesson de bouteille pour convaincre un vizir sarcastique de réexaminer sa décision.
                                                </td>
                                                <td><input id="id-fiche-bonus-intimidation" type="number" name="bonus-intimidation" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Intuition (INT)</td>
                                                <td>
                                                Un jet de Sagesse (Intuition) détermine si vous pouvez déceler les véritables intentions d'une créature, comme lorsque vous tentez de savoir si elle ment ou pour prévoir son prochain mouvement. Cela implique de lire le langage du corps, détecter ses habitudes de langage et les changements dans ses manières.
                                                </td>
                                                <td><input id="id-fiche-bonus-intuition" type="number" name="bonus-intuition" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Investigation (INT)</td>
                                                <td>
                                                Lorsque vous regardez autour de vous pour trouver des indices et faire des déductions sur la base de ces indices, vous faites un jet d'Intelligence (Investigation). Vous pouvez en déduire l'emplacement d'un objet caché, discerner en fonction de l'apparence d'une blessure le type d'arme utilisé, ou déterminer le point faible dans un tunnel pour causer son effondrement. Se pencher sur d'anciens manuscrits à la recherche d'informations cachées peut aussi demander un jet d'Intelligence (Investigation).
                                                </td>
                                                <td><input id="id-fiche-bonus-investigation" type="number" name="bonus-investigation" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Maîtrise des arcanes (SAG)</td>
                                                <td>
                                                    Un jet de SAG (Maîtrise des arcanes) Détermine votre capacité à maîtrisé votre mana et à le ressentir.
                                                </td>
                                                <td><input id="id-fiche-bonus-maitrise-arcanes" type="number" name="have-maitrise-des-arcanes" value="-4?>"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Médecine (SAG)</td>
                                                <td>
                                                    Un jet de Sagesse (Médecine) permet d'essayer de stabiliser un compagnon mourant ou de diagnostiquer une maladie.
                                                </td>
                                                <td><input id="id-fiche-bonus-medecine" type="number" name="bonus-medecine" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Mystères (INT)</td>
                                                <td>
                                                Un jet d'Intelligence (Mystères) évalue votre aptitude à connaître et à comprendre le fonctionnement d'Itacante, des étages, des plans, des fonctionnements des autres royaumes...
                                                </td>
                                                <td><input id="id-fiche-bonus-mysteres" type="number" name="bonus-mysteres" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Nature (INT)</td>
                                                <td>
                                                    Un jet d'Intelligence (Nature) évalue votre aptitude à vous rappeler des informations sur un type de terrain, des plantes ou des animaux, la météo et les cycles naturels.
                                                </td>
                                                <td><input id="id-fiche-bonus-nature" type="number" name="bonus-nature" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Perception (SAG)</td>
                                                <td>
                                                    Un jet de Sagesse (Perception) permet de repérer, entendre ou détecter la présence de quelque chose. Il mesure votre conscience de l'environnement et l'acuité de vos sens. Par exemple, vous pouvez essayer d'entendre une conversation à travers une porte fermée, espionner par une fenêtre ouverte, ou entendre des monstres se faufiler dans la forêt. Vous pouvez aussi essayer de repérer des choses qui sont cachées ou difficiles à déceler, que ce soient des orcs en embuscade sur une route, des voyous cachés dans l'ombre d'une ruelle ou la lueur d'une chandelle sous une porte secrète fermée.
                                                </td>
                                                <td><input id="id-fiche-bonus-perception" type="number" name="bonus-perception" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Persuasion (CHA)</td>
                                                <td>
                                                Lorsque vous essayez d'influencer quelqu'un ou un groupe de personnes avec tact, grâce, ou de bonnes manières, le MD peut vous demander de faire un jet de Charisme (Persuasion). En règle générale, vous utilisez la persuasion lorsque vous agissez de bonne foi, afin de favoriser l'amitié, faire des demandes cordiales, ou utiliser l'étiquette appropriée. Vous pouvez utiliser la persuasion pour convaincre un chambellan de laisser votre groupe voir le roi, négocier la paix entre deux tribus en guerre, ou motiver une foule de citadins.
                                                </td>
                                                <td><input id="id-fiche-bonus-persuasion" type="number" name="bonus-persuasion" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Religion (INT)</td>
                                                <td>
                                                Un jet d'Intelligence (Religion) évalue votre aptitude à vous rappeler des choses à propos des dieux, des rites et des prières, la hiérarchie religieuse, les symboles sacrés et les pratiques de cultes secrets.
                                                </td>
                                                <td><input id="id-fiche-bonus-religion" type="number" name="bonus-religion" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Représentation (CHA)</td>
                                                <td>
                                                    Un jet de Charisme (Représentation) détermine la façon dont vous pouvez enchanter un public par la musique, la danse, le théâtre, le conte ou toute autre forme de divertissement.
                                                </td>
                                                <td><input id="id-fiche-bonus-representation" type="number" name="bonus-representation" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Survie (SAG)</td>
                                                <td>
                                                Le MD peut vous demander de faire un jet de Sagesse (Survie) pour suivre des traces, chasser du gibier sauvage, guider votre groupe sur un terrain gelé, identifier des traces indiquant qu'un ours-hibou vit à proximité, prévoir le temps ou éviter des sables mouvants et autres catastrophes naturelles.
                                                </td>
                                                <td><input id="id-fiche-bonus-survie" type="number" name="bonus-survie" value="-4"></td>
                                            </tr>
                                            <tr>
                                            <td scope="col">Tromperie (CHA)</td>
                                                <td>
                                                    Un jet de Charisme (Tromperie) détermine si vous pouvez cacher la vérité avec efficacité, soit verbalement, soit par vos actions. La tromperie peut englober beaucoup de choses, depuis l'ambiguïté de ses dires jusqu'au mensonge pur et simple. Des situations typiques sont d'essayer d'embobiner un garde, duper un commerçant, gagner de l'argent au jeu, vous faire passer pour quelqu'un d'autre à l'aide d'un déguisement, apaiser les soupçons de quelqu'un avec une fausse assurance, ou maintenir un visage impassible tout en racontant un mensonge flagrant.
                                                </td>
                                                <td><input id="id-fiche-bonus-tromperie" type="number" name="bonus-tromperie" value="-4"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-12 col-md-6">
                                    <h3>Traits</h3>
                                    <p>
                                        Les traits sont des compétences que seul certaines personnes possèdent. Cela peut aller au trait bon nageur à l'addiction aux cacahuètes.
                                    </p>
                                    <div class="input-group mb-3">
                                        <input id="add-trait-nom" type="text" class="form-control" placeholder="Nom du trait">
                                        <textarea id="add-trait-description" type="text" class="form-control" placeholder="Description"></textarea>
                                        <textarea id="add-trait-bonus" type="text" class="form-control" placeholder="Bonus/Malus"></textarea>
                                        <button class="btn btn-secondary" onclick="add_carac('trait')" type="button" aria-label="Ajouter le trait">Ajouter</button>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="table-body-trait" class="table border-dark">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Nom</th>
                                                    <th scope="col">Description</th>
                                                    <th scope="col">Bonus/Malus</th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="table-trait-body" class="table-group-divider">
                                                    <!-- foreach($fiche_json->trait as $trait => $trait_info){
                                                        echo "<tr id=\"tr-trait-" . $trait . "\">";
                                                            echo "<td scope=\"col\" id=\"td-trait-nom-" . $trait ."\">" . $trait . "</td>";
                                                            echo "<td scope=\"col\" id=\"td-trait-description-" . $trait ."\">" . $trait_info->description . "</td>";
                                                            echo "<td scope=\"col\" id=\"td-trait-bonus-" . $trait ."\">" . $trait_info->bonus_malus . "</td>";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-danger ita-btn-danger-table\" onclick=\"delete_carac('" . addslashes($trait) ."', 'trait')\"><i class=\"bi bi-trash3\"></i></button></td>";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-secondary ita-btn-secondary-table\" onclick=\"modif_carac('" . addslashes($trait) . "', 'trait')\">Modifier</button></td>";
                                                        echo "</tr>";
                                                    } -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade" id="nav-equipement" role="tabpanel" aria-labelledby="nav-equipement-tab" tabindex="0">
                            <div class="row">
                                <h2>Armement</h2>
                                <div class="table-responsive">
                                    <table id="table-armement" class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col">Nom de l'arme</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Dégâts</th>
                                                <th scope="col">Parade</th>
                                                <th scope="col">Portée</th>
                                                <th scope="col">Rupture</th>
                                                <th scope="col">Bonus / Malus divers</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td scope="col"><input id="id-fiche-nom-arme-1" name="nom-arme-1" type="text" class="form-control"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-arme-1" name="type-arme-1" class="form-select" aria-label="Type de l'arme 1">
                                                        <option value="tranchant">Tranchant</option>
                                                        <option value="contendant">Contendant</option>
                                                        <option value="percant">Perçant</option>
                                                        <option value="distance">Distance</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-degat-arme-1" name="degat-arme-1" type="text" class="form-control"></td>
                                                <td scope="col"><input id="id-fiche-parade-arme-1" name="parade-arme-1" type="number" class="form-control" value="0"></td>
                                                <td scope="col"><input id="id-fiche-portee-arme-1" name="portee-arme-1" type="text" class="form-control"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-arme-1" name="rupture-arme-1" class="form-select" aria-label="Rupture de l'arme 1">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-arme-1" name="bonus-arme-1" type="text" class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col"><input id="id-fiche-nom-arme-2" name="nom-arme-2" type="text" class="form-control"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-arme-2" name="type-arme-2" class="form-select" aria-label="Type de l'arme 2">
                                                        <option value="tranchant">Tranchant</option>
                                                        <option value="contendant">Contendant</option>
                                                        <option value="percant">Perçant</option>
                                                        <option value="distance">Distance</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-degat-arme-2" name="degat-arme-2" type="text" class="form-control"></td>
                                                <td scope="col"><input id="id-fiche-parade-arme-2" name="parade-arme-2" type="number" class="form-control" value="0"td>
                                                <td scope="col"><input id="id-fiche-portee-arme-2" name="portee-arme-2" type="text" class="form-control"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-arme-2" name="rupture-arme-2" class="form-select" aria-label="Rupture de l'arme 2">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-arme-2" name="bonus-arme-2" type="text" class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col"><input id="id-fiche-nom-arme-3" name="nom-arme-3" type="text" class="form-control"value=""></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-arme-3" name="type-arme-3" class="form-select" aria-label="Type de l'arme 3">
                                                        <option value="tranchant">Tranchant</option>
                                                        <option value="contendant">Contendant</option>
                                                        <option value="percant">Perçant</option>
                                                        <option value="distance">Distance</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-degat-arme-3" name="degat-arme-3" type="text" class="form-control"></td>
                                                <td scope="col"><input id="id-fiche-parade-arme-3" name="parade-arme-3" type="number" class="form-control" value="0" ></td>
                                                <td scope="col"><input id="id-fiche-portee-arme-3" name="portee-arme-3" type="text" class="form-control"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-arme-3" name="rupture-arme-3" class="form-select" aria-label="Rupture de l'arme 3">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-arme-4" name="bonus-arme-3" type="text" class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col"><input id="id-fiche-nom-arme-4" name="nom-arme-4" type="text" class="form-control" value="" ></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-arme-4" name="type-arme-4" class="form-select" aria-label="Type de l'arme 4">
                                                        <option value="tranchant">Tranchant</option>
                                                        <option value="contendant">Contendant</option>
                                                        <option value="percant">Perçant</option>
                                                        <option value="distance">Distance</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-degat-arme-4" name="degat-arme-4" type="text" class="form-control" value="" ></td>
                                                <td scope="col"><input id="id-fiche-parade-arme-4" name="parade-arme-4" type="number" class="form-control" value="0" ></td>
                                                <td scope="col"><input id="id-fiche-portee-arme-4" name="portee-arme-4" type="text" class="form-control" ></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-arme-4" name="rupture-arme-4" class="form-select" aria-label="Rupture de l'arme 4">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">>1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-arme-4" name="bonus-arme-4" type="text" class="form-control"></textarea></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Bouclier</h2>
                                <div class="table-responsive">
                                    <table id="table-bouclier" class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">Nom du bouclier</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Parade</th>
                                                <th scope="col">PR physique</th>
                                                <th scope="col">PR magique</th>
                                                <th scope="col">Rupture</th>
                                                <th scope="col">Bonus / Malus divers</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            <tr>
                                                <td scope="col"><input id="id-fiche-nom-bouclier" name="nom-bouclier" type="texte" class="form-control" value="" ></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-bouclier" name="type-bouclier" class="form-select" aria-label="Type du bouclier">
                                                        <option value="leger">Léger</option>
                                                        <option value="intermediaire">Intermédiaire</option>
                                                        <option value="lourd">Lourd</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-parade-bouclier" name="parade-bouclier" type="number" class="form-control" value="0"></td>
                                                <td scope="col"><input id="id-fiche-pr-physique-bouclier" name="pr-phy-bouclier" type="number" class="form-control" value="0"></td>
                                                <td scope="col"><input id="id-fiche-pr-magique-bouclier" name="pr-mag-bouclier" type="number" class="form-control" value="0"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-bouclier" name="rupture-bouclier" class="form-select" aria-label="Rupture du bouclier">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-bouclier" name="bonus-bouclier" type="text" class="form-control"></textarea></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Armure</h2>
                                <div class="table-responsive">
                                    <table id="table-armure" class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col" id="head-piece-armure">Pièce d'armure</th>
                                                <th scope="col" id="head-nom-armure">Nom</th>
                                                <th scope="col" id="head-type-armure">Type</th>
                                                <th scope="col" id="head-pr-physique-armure">PR physique</th>
                                                <th scope="col" id="head-pr-magique-armure">PR magique</th>
                                                <th scope="col" id="head-rupture-armure">Rupture</th>
                                                <th scope="col" id="head-bonus-malus-armure">Bonus / Malus divers</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            <tr>
                                                <td scope="col" aria-labelledby="head-piece-armure" id="td-armure-naturelle">Naturelle</td>
                                                <td scope="col"></td>
                                                <td scope="col"></td>
                                                <td scope="col"><input id="id-fiche-pr-phy-armure-1" name="pr-phy-armure-1" type="number" class="form-control" value="0" aria-labelledby="head-pr-physique-armure td-armure-naturelle"></td>
                                                <td scope="col"><input id="id-fiche-pr-mag-armure-1" name="pr-mag-armure-1" type="number" class="form-control" value="0" aria-labelledby="head-pr-magique-armure td-armure-naturelle"></td>
                                                <td scope="col"></td>
                                                <td scope="col"><textarea id="bonus-armure-1" name="bonus-armure-1" type="text" class="form-control" aria-labelledby="head-bonus-malus-armure td-armure-naturelle"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col" aria-labelledby="head-piece-armure" id="td-armure-tete">Tête</td>
                                                <td scope="col"><input id="id-fiche-nom-armure-2" name="nom-armure-2" type="text" class="form-control" aria-labelledby="head-nom-armure td-armure-tete"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-armure-2" name="type-armure-2" class="form-select" aria-label="head-type-armure td-armure-tete">
                                                        <option value="legere">Légère</option>
                                                        <option value="intermediaire">Intermédiaire</option>
                                                        <option value="lourde">Lourde</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-pr-phy-armure-2" name="pr-phy-armure-2" type="number" class="form-control" value="0" aria-labelledby="head-pr-physique-armure td-armure-tete"></td>
                                                <td scope="col"><input id="id-fiche-pr-mag-armure-2" name="pr-mag-armure-2" type="number" class="form-control" value="0" aria-labelledby="head-pr-magique-armure td-armure-tete"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-armure-2" name="rupture-armure-2" class="form-select" aria-label="Rupture de l'armure" aria-labelledby="head-rupture-armure td-armure-tete">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-armure-2" name="bonus-armure-2" type="text" class="form-control" aria-labelledby="head-bonus-malus-armure td-armure-tete"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-armure-torse">Torse</td>
                                                <td scope="col"><input id="id-fiche-nom-armure-3" name="nom-armure-3" type="text" class="form-control" value="" aria-labelledby="head-nom-armure td-armure-torse"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-armure-3" name="type-armure-3" class="form-select" aria-label="head-type-armure td-armure-torse">
                                                        <option value="legere">Légère</option>
                                                        <option value="intermediaire" >Intermédiaire</option>
                                                        <option value="lourde">Lourde</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-pr-phy-armure-3" name="pr-phy-armure-3" type="number" class="form-control" value="0" aria-labelledby="head-pr-physique-armure td-armure-torse"></td>
                                                <td scope="col"><input id="id-fiche-pr-mag-armure-3" name="pr-mag-armure-3" type="number" class="form-control" value="0" aria-labelledby="head-pr-magique-armure td-armure-torse"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-armure-3" name="rupture-armure-3" class="form-select" aria-labelledby="head-rupture-armure td-armure-torse">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-armure-3" name="bonus-armure-3" type="text" class="form-control" aria-labelledby="head-bonus-malus-armure td-armure-torse"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-armure-bras">Bras</td>
                                                <td scope="col"><input id="id-fiche-nom-armure-4" name="nom-armure-4" type="text" class="form-control" aria-labelledby="head-nom-armure td-armure-bras" value=""></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-armure-4" name="type-armure-4" class="form-select" aria-label="Type d'armure" aria-labelledby="head-type-armure td-armure-bras">
                                                        <option value="legere">Légère</option>
                                                        <option value="intermediaire">Intermédiaire</option>
                                                        <option value="lourde">Lourde</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-pr-phy-armure-4" name="pr-phy-armure-4" type="number" class="form-control" value="0" aria-labelledby="head-pr-physique-armure td-armure-bras"></td>
                                                <td scope="col"><input id="id-fiche-pr-mag-armure-4" name="pr-mag-armure-4" type="number" class="form-control" value="0" aria-labelledby="head-pr-magique-armure td-armure-bras"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-armure-4" name="rupture-armure-4"class="form-select" aria-labelledby="head-rupture-armure td-armure-bras">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-armure-4" name="bonus-armure-4" type="text" class="form-control" aria-labelledby="head-bonus-malus-armure td-armure-bras"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col" id="td-armure-jambes">Jambes</td>
                                                <td scope="col"><input id="id-fiche-nom-armure-5" name="nom-armure-5" type="text" class="form-control" value="" aria-labelledby="head-nom-armure td-armure-jambes"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-type-armure-5" name="type-armure-5" class="form-select" aria-label="Type d'armure" aria-labelledby="head-type-armure td-armure-jambes">
                                                        <option value="legere">Légère</option>
                                                        <option value="intermediaire">Intermédiaire</option>
                                                        <option value="lourde">Lourde</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><input id="id-fiche-pr-phy-armure-5" name="pr-phy-armure-5" type="number" class="form-control" value="0" aria-labelledby="head-pr-physique-armure td-armure-jambes"></td>
                                                <td scope="col"><input id="id-fiche-pr-mag-armure-5" name="pr-mag-armure-5" type="number" class="form-control" value="0" aria-labelledby="head-pr-magique-armure td-armure-jambes"></td>
                                                <td scope="col">
                                                    <select id="id-fiche-rupture-armure-5" name="rupture-armure-5" class="form-select" aria-labelledby="head-rupture-armure td-armure-jambes">
                                                        <option value="4">1 à 4</option>
                                                        <option value="3">1 à 3</option>
                                                        <option value="2">1 à 2</option>
                                                        <option value="1">1</option>
                                                        <option value="0">Indestructible</option>
                                                    </select>
                                                </td>
                                                <td scope="col"><textarea id="id-fiche-bonus-armure-5" name="bonus-armure-5" type="text" class="form-control" aria-labelledby="head-bonus-malus-armure td-armure-jambes"></textarea></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Objets Magiques</h2>
                                <div class="table-responsive">
                                    <table class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">Objet magique</th>
                                                <th scope="col">Nom</th>
                                                <th scope="col">Effet</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-group-divider">
                                            <tr>
                                                <td scope="col">Anneau droit</td>
                                                <td scope="col"><input id="id-fiche-nom-anneau-droit" name="nom-anneau-droit" type="text" class="form-control"></td>
                                                <td scope="col"><textarea id="id-fiche-effet-anneau-droit" name="effet-anneau-droit" type="text" class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col">Anneau gauche</td>
                                                <td scope="col"><input id="id-fiche-nom-anneau-gauche" name="nom-anneau-gauche" type="text" class="form-control"></td>
                                                <td scope="col"><textarea id="id-fiche-effet-anneau-gauche" name="effet-anneau-gauche" type="text" class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td scope="col">Collier</td>
                                                <td scope="col"><input id="id-fiche-nom-collier" name="nom-collier" type="text" class="form-control"></td>
                                                <td scope="col"><textarea id="id-fiche-effet-collier" name="effet-collier" type="text" class="form-control"></textarea></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Potion</h2>
                                <div class="input-group mb-3">
                                    <input id="add-potion-nom" type="text" class="form-control" placeholder="Nom de la potion">
                                    <textarea id="add-potion-effet" type="text" class="form-control" placeholder="Effet"></textarea>
                                    <input id="add-potion-dose" type="number" class="form-control" placeholder="Nombre de doses" value="0">
                                    <button class="btn btn-secondary" onclick="add_carac('potion')" type="button">Ajouter</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">Nom</th>
                                                <th scope="col">Effet</th>
                                                <th scope="col">Dose</th>
                                                <th scope="col"></th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-body-potion" class="table-group-divider">
                                                    <!-- foreach($fiche_json->potion as $potion => $potion_info){
                                                        echo "<tr id=\"tr-potion-" . $potion . "\">";
                                                            echo "<td scope=\"col\" id=\"td-potion-nom-" . $potion ."\">" . $potion . "</td>";
                                                            echo "<td scope=\"col\" id=\"td-potion-description-" . $potion ."\">" . $potion_info->effet . "</td>";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-danger ita-btn-danger-table\" onclick=\"delete_carac('" . addslashes($potion) ."', 'potion')\"><i class=\"bi bi-trash3\"></i></button></td>";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-secondary ita-btn-secondary-table\" onclick=\"modif_carac('" . addslashes($potion) . "', 'potion')\">Modifier</button></td>";
                                                        echo "</tr>";
                                                    } -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Bourse</h2>
                                <div class="row">
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <input id="id-fiche-po" name="fiche-po" type="text" class="form-control" placeholder="Pièces d'or possédées par la créature" autocomplete="off" value="0">
                                            <label for="id-fiche-po">Pièces d'or</label>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <input id="id-fiche-pa" name="fiche-pa" type="text" class="form-control" placeholder="Pièces d'argent possédées par la créature" autocomplete="off" value="0">
                                            <label for="id-fiche-pa">Pièces d'argent</label>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-floating">
                                            <input id="id-fiche-pb" name="fiche-pb" type="text" class="form-control" placeholder="Pièces de bronze possédées par la créature" autocomplete="off" value="0">
                                            <label for="id-fiche-pb">Pièces de bronzes</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <h2>Inventaire</h2>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade" id="nav-magie-coups-speciaux" role="tabpanel" aria-labelledby="nav-magie-coups-speciaux-tab" tabindex="0">
                            <div class="row">
                                <h2>Coups spéciaux</h2>
                                <div class="input-group mb-3">
                                    <input id="add-special-nom" type="text" class="form-control" placeholder="Nom du coup spécial" style="max-width: 300px;">
                                    <textarea id="add-special-effet" type="text" class="form-control" placeholder="Effet"></textarea>
                                    <button class="btn btn-secondary" onclick="add_carac('special')" type="button" aria-label="Ajouter un coup spécial">Ajouter</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table border-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col-3">Nom</th>
                                                <th scope="col-6">Effet</th>
                                                <th scope="col-1"></th>
                                                <th scope="col-1"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-body-special" class="table-group-divider">
                                                   <!--   foreach($fiche_json->special as $special => $special_info){
                                                        echo "<tr id=\"tr-special-" . $special . "\"> \n";
                                                            echo "<td scope=\"col\" id=\"td-special-nom-" . $special ."\">" . $special . "</td> \n";
                                                            echo "<td scope=\"col\" id=\"td-special-effet-" . $special ."\">" . $special_info->effet . "</td> \n";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-danger ita-btn-danger-table\" onclick=\"delete_carac('" . addslashes($special) . "', 'special')\"><i class=\"bi bi-trash3\"></i></button></td> \n";
                                                            echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-secondary ita-btn-secondary-table\" onclick=\"modif_carac('" . addslashes($special) . "', 'special')\">Modifier</button></td> \n";
                                                        echo "</tr>";
                                                    }  -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row" id="ligne-sortilege">
                                <h2>Sorts</h2>
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">
                                                <div class="input-group">
                                                    <span class="input-group-text">Nom du sort</span>
                                                    <input id="add-sort-nom" type="text" class="form-control" aria-label="Entrez le nom du sort">
                                                </div>
                                            </th>
                                            <th scope="col">
                                                <div class="input-group">
                                                    <span class="input-group-text">Niveau du sort</span>
                                                    <input id="add-sort-niveau" type="number" class="form-control" aria-label="Entrez le niveau du sort" min="0" max="7" value="0">
                                                </div>
                                            </th>
                                            <td scope="col"><button type="button" class="btn btn-warning" onclick="add_sort()">Ajouter le sort</i></button>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="4">
                                                <table class="table mb-0">
                                                    <tr>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Temps d'incantation</span>
                                                                <input id="add-sort-incantation" type="texte" class="form-control" aria-label="Entrez le temps d'incantation du sort">
                                                            </div>
                                                        </td>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Portée</span>
                                                                <input id="add-sort-portee" type="texte" class="form-control" aria-label="Entrez la portée du sort">
                                                            </div>
                                                        </td>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Coût</span>
                                                                <input id="add-sort-cout" type="texte" class="form-control" aria-label="Entrez le coût du sort">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Durée</span>
                                                                <input id="add-sort-duree" type="texte" class="form-control" aria-label="Entrez la durée du sort">
                                                            </div>
                                                        </td>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Aire d'effet</span>
                                                                <input id="add-sort-aire-effet" type="texte" class="form-control" aria-label="Entrez l'aire d'effet du sort">
                                                            </div>
                                                        </td>
                                                        <td scope="col">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Formule</span>
                                                                <input id="add-sort-formule" type="texte" class="form-control" aria-label="Entrez la formule du sort">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td scope="col" colspan="4">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Effet</span>
                                                                <textarea id="add-sort-effet" type="texte" class="form-control" aria-label="Entrez l'effet du sort"></textarea>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Réussite critique</span>
                                                                <textarea id="add-sort-reussite-critique" type="texte" class="form-control" aria-label="Entrez l'effet en cas de réussite critique"></textarea>
                                                            </div>
                                                        </td>
                                                        <td colspan="2">
                                                            <div class="input-group">
                                                                <span class="input-group-text">Échec critique</span>
                                                                <textarea id="add-sort-echec-critique" type="texte" class="form-control" aria-label="Entrez l'effet en cas d'échec critique"></textarea>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                    <!-- foreach($fiche_json->sort as $sort => $sort_info){
                                        echo "<table class=\"table table-striped\" id=\"table-sort-" . $sort ."\">";
                                            echo "<thead>";
                                                echo "<tr>";
                                                    echo "<th scope=\"col\" id=\"th-sort-nom-" . $sort ."\">Nom du sort</th>";
                                                    echo "<td scope=\"col\" id=\"td-sort-nom-" . $sort ."\" aria-labelledby=\"th-sort-nom-". $sort ."\">" . $sort ."</td>";
                                                    echo "<th scope=\"col\" id=\"th-sort-niveau-". $sort ."\">Niveau du sort</th>";
                                                    echo "<td scope=\"col\" id=\"td-sort-niveau-". $sort ."\" aria-labelledby=\"th-sort-niveau-". $sort ."\">" . $sort_info->niveau ."</td>";
                                                    echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-danger ita-btn-danger-table\" aria-label=\"Supprimer le sort " . $sort ."\" onclick=\"delete_carac('" . addslashes($sort) ."', 'sort')\"><i class=\"bi bi-trash3\"></i></button></td>";
                                                    echo "<td scope=\"col\"><button type=\"button\" class=\"btn btn-secondary ita-btn-secondary-table\" aria-label=\"Modifier le sort " . $sort ."\" onclick=\"modif_carac('" . addslashes($sort) ."', 'sort')\">Modifier</button></td>";
                                                    echo "</tr>";
                                            echo "</thead>";
                                            echo "<tbody>";
                                                echo "<tr>";
                                                    echo "<td colspan=\"6\">";
                                                        echo "<table class=\"table mb-0\">";
                                                            echo "<tr>";
                                                                echo "<th scope=\"col\" id=\"th-sort-incantation-" . $sort ."\">Incantation</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-incantation-" . $sort ."\" aria-labelledby=\"th-sort-incantation-" . $sort ."\">" . $sort_info->incantation ." </td>";
                                                                echo "<th scope=\"col\" id=\"th-sort-portee-" . $sort ."\">Portée</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-portee-" . $sort ."\" aria-labelledby=\"th-sort-portee-". $sort ."\">". $sort_info->portee ."</td>";
                                                                echo "<th scope=\"col\" id=\"th-sort-cout-" . $sort ."\">Coût</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-cout-" . $sort ."\" aria-labelledby=\"th-sort-cout-" . $sort ."\">" . $sort_info->cout ."</td>";
                                                            echo "</tr>";
                                                            echo "<tr>";
                                                                echo "<th scope=\"col\" id=\"th-sort-duree-" . $sort ."\">Durée</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-duree-" . $sort ."\" aria-labelledby=\"th-sort-duree-" . $sort ."\">" . $sort_info->duree ."</td>";
                                                                echo "<th scope=\"col\" id=\"th-sort-aire-effet-" . $sort ."\">Aire d'effet</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-aire-effet-" . $sort ."\" aria-labelledby=\"th-sort-aire-effet-" . $sort ."\">" . $sort_info->aire_effet ."</td>";
                                                                echo "<th scope=\"col\" id=\"th-sort-formule-" . $sort ."\">Formule</th>";
                                                                echo "<td scope=\"col\" id=\"td-sort-formule-" . $sort ."\" aria-labelledby=\"th-sort-formule-" . $sort ."\">" . $sort_info->formule ."</td>";
                                                            echo "</tr>";
                                                            echo "<tr>";
                                                                echo "<th scope=\"col\" id=\"th-sort-effet-" . $sort ."\">Effet</th>";
                                                                echo "<td colspan=\"5\" id=\"td-sort-effet-" . $sort ."\" aria-labelledby=\"th-sort-effet-" . $sort ."\">" . $sort_info->effet ."</td>";
                                                            echo "</tr>";
                                                            echo "<tr>";
                                                                echo "<th scope=\"col\" id=\"th-sort-reussite-critique-" . $sort ."\">Réussite Critique</th>";
                                                                echo "<td colspan=\"2\" id=\"td-sort-reussite-critique-" . $sort ."\" aria-labelledby=\"th-sort-reussite-critique-" . $sort ."\">" . $sort_info->reussite_critique ."</td>";
                                                                echo "<th scope=\"col\" id=\"th-sort-echec-critique-" . $sort ."\">Échec Critique</th>";
                                                                echo "<td colspan=\"2\" id=\"td-sort-echec-critique-" . $sort ."\" aria-labelledby=\"th-sort-echec-critique-" . $sort ."\">" . $sort_info->echec_critique ."</td>";
                                                            echo "</tr>";
                                                        echo "</table>";
                                                    echo "</td>";
                                                echo "</tr>";
                                            echo "</tbody>";
                                        echo "</table>";
                                    } -->
                            </div>
                        </div>
                        <div class="row my-2">
                            <button id="id-btn-save-modif" type="submit" class="btn btn-warning">Enregistrer les modifications</button>
                            <button id="id-btn-create" type="submit" class="btn btn-danger">Créer</button>
                        </div>
                    </div>
                </div>
            </div>
        <form>
    </main>
</body>
</html>

<script src="/dist/app.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous"></script>
<script> $("#id-header").load('/front/header.html');</script>

<script>
    var traits_json = {};
    var potion_json = {};
    var special_json = {};
    var sort_json = {};

    JSON.stringify(traits_json) == "[]" ? traits_json = {} : "";
    JSON.stringify(potion_json) ? potion_json = {} : "";
    JSON.stringify(special_json) ? special_json = {} : "";
    JSON.stringify(sort_json) ? sort_json = {} : "";

// Arrow function to get the parameter of the specified key
getParameter = (key) => {
    // Address of the current window
    address = window.location.search

    // Returns a URLSearchParams object instance
    parameterList = new URLSearchParams(address)

    // Returning the respected value associated
    // with the provided key
    return parameterList.get(key)
}

const save_fiche = (fiche_nom, fiche_json, type_fiche) => {
    formData1 = new FormData();
    var fileInput = document.getElementById('id-fiche-image-input');
    var file = fileInput.files[0];  
    if (file != null){
        //S'il y a une image, on la sauvegarde
        if (file.type.match(/image.*/)) {
            var reader = new FileReader();

            reader.onload = function(e) {
                var img = new Image();
                img.src = reader.result;

            }
            reader.readAsDataURL(file);
            formData1.append("image", file); 
        }else{
            alert('Image invalide');
        }
        formData1.append("image", "")
    }
    formData1.append("fiche_type", type_fiche);
    getParameter("id_fiche") != null ? formData1.append("fiche_id", getParameter("id_fiche")) : formData1.append("fiche_id", "") ;

    $.ajax({
        url: "/traitement/upload-image.php",
        type: "POST",
        data: formData1,
        enctype: 'multipart/form-data',
        processData: false,
        contentType: false,
        success: function(data){
            var directory = JSON.parse(data)["directory"];
            //On sauvegarde la fiche
            formData2 = new FormData();
                formData2.append("fiche_json", fiche_json);
                formData2.append("fiche_nom", fiche_nom);
                formData2.append("fiche_type",type_fiche);
                formData2.append("directory", directory);
                if (getParameter("id_fiche") != null) {
                    formData2.append("fiche_id", getParameter("id_fiche"))
                    formData2.append("action", "save")
                }else{
                    formData2.append("id_fiche", "") ;
                    formData2.append("action", "create")
                }
                $.ajax({
                    url: "/traitement/save_fiche.php",
                    type: "POST",
                    data: formData2,
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    success: function(data){
                        if (getParameter("id_fiche") == null) {
                            alert("Fiche créée avec succès");
                            window.location = window.location.href + "&id_fiche=" + JSON.parse(data)["resultat"];
                        } else {
                            alert("Fiche sauvegardée avec succès");
                        }
                    },
                    error: function(data){
                        alert('Request Status: ' + data.status + ' Status Text: ' + data.statusText + ' ' + data.responseText);
                    },
                });
        },
        error: function(data){
            alert('Request Status: ' + data.status + ' Status Text: ' + data.statusText + ' ' + data.responseText);
            return;
        },
    });
}
    /**@method previewImage : affiche une image entrée dans l'input dès que ce dernier est modifié*/
    const previewImage = e => {
        const preview = document.getElementById('id-fiche-image-preview');
        const input_image_src = document.getElementById('id-fiche-image-src');
        if (e.target.files[0] != undefined){
            preview.src = URL.createObjectURL(e.target.files[0]);
            preview.onload = () => URL.revokeObjectURL(preview.src);
        }else{
            preview.src = "";
        }
    };

    /**@method add_carac : Ajoute des éléments à un tableau ainsi que dans le json correspondant
    * @param carac (string) : la caractéristique à ajouter au tableau
    * @var carac_1 / carac_2 / etc (string) : les valeurs à entrer dans le tableau
    * @var carac_exist (bool) : si la caractéristique 1 existe déjà dans le tableau, carac_exist = true (on doit modifier une ligne déjà existante)
    */
    const add_carac = carac => {
        if (carac == "trait"){
            var carac_1 = document.getElementById('add-trait-nom').value;
            var carac_2 = document.getElementById('add-trait-description').value;
            var carac_3;
            document.getElementById('add-trait-bonus').value == "" ? carac_3 = '""' : carac_3 = document.getElementById('add-trait-bonus').value;
            if (!carac_1 || !carac_2){
                alert("Veuillez au moins remplir le nom du trait ainsi que la description");
                return;
            }
            var list_carac = [{"nom":carac_1}, {"description" : carac_2}, {"bonus" : carac_3}];
            //On vérifie si le trait est déjà dans le tableau
            traits_json[carac_1] ? carac_exist = true : carac_exist = false;
            //On ajoute le trait dans traits_json
            var obj = {"description" :  carac_2 , "bonus_malus" :  carac_3 };
            traits_json[carac_1] = obj;
        }else if (carac == "potion"){
            var carac_1 = document.getElementById('add-potion-nom').value;
            var carac_2 = document.getElementById('add-potion-effet').value;
            var carac_3 = document.getElementById('add-potion-dose').value;
            if (!carac_1 || !carac_2 || !carac_3){
                alert("Veuillez remplir tous les champs");
                return;
            }
            var list_carac = [{"nom" : carac_1}, {"effet" : carac_2}, {"dose" : carac_3}];
            //On vérifie si la potion est déjà dans le tableau
            potion_json[carac_1] ? carac_exist = true : carac_exist = false;
            //On ajoute la potion dans potion_json
            var obj = {"effet" : + carac_2 , "dose" :  carac_3 };
            potion_json[carac_1] = obj;
        } else if (carac == "special"){
            var carac_1 = document.getElementById('add-special-nom').value;
            var carac_2 = document.getElementById('add-special-effet').value;
            if (!carac_1 || !carac_2){
                alert("Veuillez remplir tous les champs");
                return;
            }
            var list_carac = [{"nom" : carac_1}, {"effet" : carac_2}];
            //On vérifie si le coup spécial est déjà dans le tableau
            traits_json[carac_1] ? carac_exist = true : carac_exist = false;
            //On ajoute le coup spécial dans spécial_json
            var obj = {"effet" :  carac_2 };
            special_json[carac_1] = obj;
        }else {
            console.error("Le nom de la caractéristique est inconnue");
            return;
        }

            if (!carac_exist){
                var ligne_table =` <tr id="tr-`+ carac + `-` + carac_1 + `"> `
                //On ajoute une ligne par caractéristiques entrées
                for (let i = 0; i < list_carac.length; i++){
                    ligne_table += `<td scope="col" id="td-` + carac + `-` + Object.keys(list_carac[i])[0] + `-` + carac_1 +`">` + list_carac[i][Object.keys(list_carac[i])[0]] + `</td>`
                    $("#add-"+ carac + "-" + Object.keys(list_carac[i])[0]).val("");
                }
                //on ajoute les boutons supprimer et modifier
                ligne_table += "<td scope=\"col\"><button type=\"button\" class=\"btn btn-danger ita-btn-danger-table\" onclick=\"delete_carac(\`" + carac_1 + "\`, \`" + carac + "\`)\"><i class=\"bi bi-trash3\"></i></button></td>";
                ligne_table += "<td scope=\"col\"><button type=\"button\" class=\"btn btn-secondary ita-btn-secondary-table\" onclick=\"modif_carac(\`" + carac_1 + "\`, \`" + carac + "\`)\">Modifier</button></td>";
                
                $("#table-body-"+ carac).append(ligne_table);
                
            }else{
                var colonnes_table = "";
                for (let i = 0; i < list_carac.length ; i++){
                    colonnes_table += `<td scope="col" id="td-` + Object.keys(list_carac[i])[0] + `-` + carac + `-` + carac_1 +`">` + list_carac[i][Object.keys(list_carac[i])[0]] + `</td>`
                    $("#add-"+ carac + "-" + Object.keys(list_carac[i])[0]).val("");
                }
                colonnes_table += 
                `
                    <td scope="col"><button type="button" class="btn btn-danger ita-btn-danger-table" onclick="delete_carac(\"` + carac_1.replace(/'/g, "\\'"); +`', '` + carac + `\")"><i class="bi bi-trash3"></i></button>
                    <td scope="col"><button type="button" class="btn btn-secondary ita-btn-secondary-table" onclick="modif_carac(\"` + carac_1.replace(/'/g, "\\'"); +`', '` + carac + `\")">Modifier</button>
                `
                $("#tr-"+ carac + "-" + carac_1)[0].innerHTML  = colonnes_table;
            }
        }

    /**@method delete_carac
    * supprime unligne d'un tableau ainsi que du json correspondant
    * @param nom_trait (string) : le nom du trait à supprimer
    */
    const delete_carac = (main_carac, carac) => {
        if (carac == "trait"){
            delete traits_json[main_carac];
        }else if (carac == "potion"){
            delete potion_json[main_carac];
        }else if (carac == "special"){
            delete special_json[main_carac];
        }else if (carac = "sort"){
            delete sort_json[main_carac];
            document.getElementById("table-sort-" + main_carac).remove();
            return
        }else{
            console.error("Le nom de la caractéristique est inconnue")
            return;
        }
        document.getElementById('tr-' + carac + '-' + main_carac).remove();
    }

    const modif_carac = (main_carac, carac) => {
        if (carac == "trait"){
            $("#add-trait-nom").val(document.getElementById("td-trait-nom-" + main_carac).innerText);
            $("#add-trait-description").val(document.getElementById("td-trait-description-" + main_carac).innerText);
            $("#add-trait-bonus").val(document.getElementById("td-trait-bonus-" + main_carac).innerText);
        }else if (carac == "potion"){
            document.getElementById('add-potion-nom').value = document.getElementById("td-potion-nom-" + main_carac).innerText;
            document.getElementById('add-potion-effet').value = document.getElementById("td-potion-effet-" + main_carac).innerText;
            document.getElementById('add-potion-dose').value = document.getElementById("td-potion-dose-" + main_carac).innerText;
        }else if (carac == "special"){
            document.getElementById('add-special-nom').value = document.getElementById("td-special-nom-" + main_carac).innerText;
            document.getElementById('add-special-effet').value = document.getElementById("td-special-effet-" + main_carac).innerText;
        }else if (carac = "sort"){
            document.getElementById('add-sort-nom').value = document.getElementById("td-sort-nom-" + main_carac).innerText;
            document.getElementById('add-sort-niveau').value = document.getElementById("td-sort-niveau-" + main_carac).innerText;
            document.getElementById('add-sort-incantation').value = document.getElementById("td-sort-incantation-" + main_carac).innerText;
            document.getElementById('add-sort-portee').value = document.getElementById("td-sort-portee-" + main_carac).innerText;
            document.getElementById('add-sort-cout').value = document.getElementById("td-sort-cout-" + main_carac).innerText;
            document.getElementById('add-sort-duree').value = document.getElementById("td-sort-duree-" + main_carac).innerText;
            document.getElementById('add-sort-aire-effet').value = document.getElementById("td-sort-aire-effet-" + main_carac).innerText;
            document.getElementById('add-sort-formule').value = document.getElementById("td-sort-formule-" + main_carac).innerText;
            document.getElementById('add-sort-effet').value = document.getElementById("td-sort-effet-" + main_carac).innerText;
            document.getElementById('add-sort-reussite-critique').value = document.getElementById("td-sort-reussite-critique-" + main_carac).innerText;
            document.getElementById('add-sort-echec-critique').value =document.getElementById("td-sort-echec-critique-" + main_carac).innerText;
        }else{
            console.error("Le nom de la caractéristique est inconnue")
            return;
        }
        delete_carac(main_carac, carac);
    }

    const add_sort = e => {
        var sort_nom = document.getElementById('add-sort-nom').value;
        var sort_niveau = document.getElementById('add-sort-niveau').value;
        var sort_incantation = document.getElementById('add-sort-incantation').value;
        var sort_portee = document.getElementById('add-sort-portee').value;
        var sort_cout = document.getElementById('add-sort-cout').value;
        var sort_duree = document.getElementById('add-sort-duree').value;
        var sort_aire_effet = document.getElementById('add-sort-aire-effet').value;
        var sort_formule = document.getElementById('add-sort-formule').value;
        var sort_effet = document.getElementById('add-sort-effet').value;
        var sort_reussite_critique = document.getElementById('add-sort-reussite-critique').value;
        var sort_echec_critique = document.getElementById('add-sort-echec-critique').value;


        if (sort_nom && sort_niveau && sort_incantation && sort_portee && sort_cout && sort_duree && sort_aire_effet && sort_formule && sort_effet && sort_reussite_critique && sort_echec_critique){
            document.getElementById('add-sort-nom').value = "";
            document.getElementById('add-sort-niveau').value = 0;
            document.getElementById('add-sort-incantation').value = "";
            document.getElementById('add-sort-portee').value = "";
            document.getElementById('add-sort-cout').value = "";
            document.getElementById('add-sort-duree').value = "";
            document.getElementById('add-sort-aire-effet').value = "";
            document.getElementById('add-sort-formule').value = "";
            document.getElementById('add-sort-effet').value = "";
            document.getElementById('add-sort-reussite-critique').value = "";
            document.getElementById('add-sort-echec-critique').value ="";
            if (!sort_json[sort_nom]){
                new_table_sort =
                `
                <table class="table table-striped" id="table-sort-` + sort_nom +`">                
                    <thead>
                        <tr>
                            <th scope="col" id="th-sort-nom-` + sort_nom +`">Nom du sort</th>
                            <td scope="col"id="td-sort-nom-` + sort_nom +`" aria-labelledby="th-sort-nom-`+ sort_nom +`">` + sort_nom +`</td>
                            <th scope="col" id="th-sort-niveau-`+ sort_nom +`">Niveau du sort</th>
                            <td scope="col" id="td-sort-niveau-`+ sort_nom +`" aria-labelledby="th-sort-niveau-`+ sort_nom +`">` + sort_niveau +`</td>
                            <td scope="col"><button type="button" class="btn btn-danger ita-btn-danger-table" aria-label="Supprimer le sort ` + sort_nom +`" onclick="delete_carac('` + sort_nom +`', 'sort')"><i class="bi bi-trash3"></i></button></td>
                            <td scope="col"><button type="button" class="btn btn-secondary ita-btn-secondary-table" aria-label="Modifier le sort ` + sort_nom +`" onclick="modif_carac('` + sort_nom +`', 'sort')">Modifier</button></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6">
                                <table class="table mb-0">
                                    <tr>
                                        <th scope="col" id="th-sort-incantation-` + sort_nom +`">Incantation</th>
                                        <td scope="col" id="td-sort-incantation-` + sort_nom +`" aria-labelledby="th-sort-incantation-` + sort_nom +`">` + sort_incantation +`</td>
                                        <th scope="col" id="th-sort-portee-` + sort_nom +`">Portée</th>
                                        <td scope="col" id="td-sort-portee-` + sort_nom +`" aria-labelledby="th-sort-portee-`+ sort_nom +`">` + sort_portee +`</td>
                                        <th scope="col" id="th-sort-cout-` + sort_nom +`">Coût</th>
                                        <td scope="col" id="td-sort-cout-` + sort_nom +`" aria-labelledby="th-sort-cout-` + sort_nom +`">` + sort_cout +`</td>
                                    </tr>
                                    <tr>
                                        <th scope="col" id="th-sort-duree-` + sort_nom +`">Durée</th>
                                        <td scope="col" id="td-sort-duree-` + sort_nom +`" aria-labelledby="th-sort-duree-` + sort_nom +`">` + sort_duree +`</td>
                                        <th scope="col" id="th-sort-aire-effet-` + sort_nom +`">Aire d'effet</th>
                                        <td scope="col" id="td-sort-aire-effet-` + sort_nom +`" aria-labelledby="th-sort-aire-effet-` + sort_nom +`">` + sort_aire_effet+`</td>
                                        <th scope="col" id="th-sort-formule-` + sort_nom +`">Formule</th>
                                        <td scope="col" id="td-sort-formule-` + sort_nom +`" aria-labelledby="th-sort-formule-` + sort_nom +`">` + sort_formule +`</td>
                                    </tr>
                                    <tr>
                                        <th scope="col" id="th-sort-effet-` + sort_nom +`">Effet</th>
                                        <td colspan="5" id="td-sort-effet-` + sort_nom +`" aria-labelledby="th-sort-effet-` + sort_nom +`">` + sort_effet +`</td>
                                    </tr>
                                    <tr>
                                        <th scope="col" id="th-sort-reussite-critique-` + sort_nom +`">Réussite Critique</th>
                                        <td colspan="2" id="td-sort-reussite-critique-` + sort_nom +`" aria-labelledby="th-sort-reussite-critique-` + sort_nom +`">` + sort_reussite_critique +`</td>
                                        <th scope="col" id="th-sort-echec-critique-` + sort_nom +`">Échec Critique</th>
                                        <td colspan="2" id="td-sort-echec-critique-` + sort_nom +`" aria-labelledby="th-sort-echec-critique-` + sort_nom +`">` + sort_echec_critique +`</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
                `;
                $("#ligne-sortilege").append(new_table_sort);
            }else{
                new_table_sort = 
                `               
                <thead>
                    <tr>
                        <th scope="col" id="th-sort-nom-` + sort_nom +`">Nom du sort</th>
                        <td scope="col"id="td-sort-nom-` + sort_nom +`" aria-labelledby="th-sort-nom-`+ sort_nom +`">` + sort_nom +`</td>
                        <th scope="col" id="th-sort-niveau-`+ sort_nom +`">Niveau du sort</th>
                        <td scope="col" id="td-sort-niveau-`+ sort_nom +`" aria-labelledby="th-sort-niveau-`+ sort_nom +`">` + sort_niveau +`</td>
                        <td scope="col"><button type="button" class="btn btn-danger ita-btn-danger-table" aria-label="Supprimer le sort ` + sort_nom +`" onclick="delete_carac('` + sort_nom +`', 'sort')"><i class="bi bi-trash3"></i></button></td>
                        <td scope="col"><button type="button" class="btn btn-secondary ita-btn-secondary-table" aria-label="Modifier le sort ` + sort_nom +`" onclick="modif_carac('` + sort_nom +`', 'sort)">Modifier</button></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6">
                            <table class="table mb-0">
                                <tr>
                                    <th scope="col" id="th-sort-incantation-` + sort_nom +`">Incantation</th>
                                    <td scope="col" id="td-sort-incantation-` + sort_nom +`" aria-labelledby="th-sort-incantation-` + sort_nom +`">` + sort_incantation +`</td>
                                    <th scope="col" id="th-sort-portee-` + sort_nom +`">Portée</th>
                                    <td scope="col" id="td-sort-portee-` + sort_nom +`" aria-labelledby="th-sort-portee-`+ sort_nom +`">` + sort_portee +`</td>
                                    <th scope="col" id="th-sort-cout-` + sort_nom +`">Coût</th>
                                    <td scope="col" id="td-sort-cout-` + sort_nom +`" aria-labelledby="th-sort-cout-` + sort_nom +`">` + sort_cout +`</td>
                                </tr>
                                <tr>
                                    <th scope="col" id="th-sort-duree-` + sort_nom +`">Durée</th>
                                    <td scope="col" id="td-sort-duree-` + sort_nom +`" aria-labelledby="th-sort-duree-` + sort_nom +`">` + sort_duree +`</td>
                                    <th scope="col" id="th-sort-aire-effet-` + sort_nom +`">Aire d'effet</th>
                                    <td scope="col" id="td-sort-aire-effet-` + sort_nom +`" aria-labelledby="th-sort-aire-effet-` + sort_nom +`">` + sort_aire_effet+`</td>
                                    <th scope="col" id="th-sort-formule-` + sort_nom +`">Formule</th>
                                    <td scope="col" id="td-sort-formule-` + sort_nom +`" aria-labelledby="th-sort-formule-` + sort_nom +`">` + sort_formule +`</td>
                                </tr>
                                <tr>
                                    <th scope="col" id="th-sort-effet-` + sort_nom +`">Effet</th>
                                    <td colspan="5" id="td-sort-effet-` + sort_nom +`" aria-labelledby="th-sort-effet-` + sort_nom +`">` + sort_effet +`</td>
                                </tr>
                                <tr>
                                    <th scope="col" id="th-sort-reussite-critique-` + sort_nom +`">Réussite Critique</th>
                                    <td colspan="2" id="td-sort-reussite-critique-` + sort_nom +`" aria-labelledby="th-sort-reussite-critique-` + sort_nom +`">` + sort_reussite_critique +`</td>
                                    <th scope="col" id="th-sort-echec-critique-` + sort_nom +`">Échec Critique</th>
                                    <td colspan="2" id="td-sort-echec-critique-` + sort_nom +`" aria-labelledby="th-sort-echec-critique-` + sort_nom +`">` + sort_echec_critique +`</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </tbody>
                `;
                $("#table-sort-" + sort_nom)[0].innerHTML  = new_table_sort;
            }
        sort_json[sort_nom] =
            {
                "niveau" : sort_niveau,
                "incantation" : sort_incantation,
                "portee" : sort_portee,
                "cout" : sort_cout,
                "duree" : sort_duree,
                "aire_effet": sort_aire_effet,
                "formule":sort_formule,
                "effet":sort_effet,
                "reussite_critique":sort_reussite_critique,
                "echec_critique":sort_echec_critique
            }    
        }else{
            alert("Veuillez remplir tous les champs");
        }
    }

$('form').submit(function(e){
    e.preventDefault();
    if(getParameter("type_fiche") == "creature"){
        var fiche_json = {
            "nom" : $("#id-fiche-nom").val(),
            "taille" : $("#id-fiche-taille").val(),
            "exp" : $("#id-fiche-exp").val(),
            "location" : {
                "mezoide" : $("#id-fiche-location-mezoide").is(':checked'),
                "rocheuses" : $("#id-fiche-location-rocheuses").is(':checked'),
                "tagata" : $("#id-fiche-location-tagata").is(':checked'),
                "oland" : $("#id-fiche-location-oland").is(':checked'),
                "iles" : $("#id-fiche-location-iles").is(':checked'),
                "big_blue" : $("#id-fiche-location-big-blue").is(':checked'),
                "desert" : $("#id-fiche-location-desert").is(':checked'),
                "paradis" : $("#id-fiche-location-paradis").is(':checked'),
                "enfer" : $("#id-fiche-location-enfer").is(':checked'),
                "life" : $("#id-fiche-location-life").is(':checked'),
                "death" : $("#id-fiche-location-death").is(':checked'),
                "archaia" : $("#id-fiche-location-archaia").is(':checked'),
            },
            "pv" : $("#id-fiche-pv").val(),
            "mana" : $("#id-fiche-mana").val(),
            "force" : $("#id-fiche-force").val(),
            "dexterite" : $("#id-fiche-dexterite").val(),
            "constitution" : $("#id-fiche-constitution").val(),
            "intelligence" : $("#id-fiche-intelligence").val(),
            "sagesse" : $("#id-fiche-sagesse").val(),
            "charisme" : $("#id-fiche-charisme").val(),
            "description" : $("#id-fiche-description").val(),
            "arme_1" : {
                "nom" : $("#id-fiche-nom-arme-1").val(),
                "degat" : $("#id-fiche-degat-arme-1").val(),
                "parade" : $("#id-fiche-parade-arme-1").val(),
                "portee" : $("#id-fiche-portee-arme-1").val(),
                "rupture" : $("#id-fiche-rupture-arme-1").val(),
                "bonus_malus" : $("#id-fiche-bonus-arme-1").val(),
            },
            "arme_2" : {
                "nom" : $("#id-fiche-nom-arme-2").val(),
                "degat" : $("#id-fiche-degat-arme-2").val(),
                "parade" : $("#id-fiche-parade-arme-2").val(),
                "portee" : $("#id-fiche-portee-arme-2").val(),
                "rupture" : $("#id-fiche-rupture-arme-2").val(),
                "bonus_malus" : $("#id-fiche-bonus-arme-2").val(),
            },
            "arme_3" : {
                "nom" : $("#id-fiche-nom-arme-3").val(),
                "degat" : $("#id-fiche-degat-arme-3").val(),
                "parade" : $("#id-fiche-parade-arme-3").val(),
                "portee" : $("#id-fiche-portee-arme-3").val(),
                "rupture" : $("#id-fiche-rupture-arme-3").val(),
                "bonus_malus" : $("#id-fiche-bonus-arme-3").val(),
            },
            "arme_4" : {
                "nom" : $("#id-fiche-nom-arme-4").val(),
                "degat" : $("#id-fiche-degat-arme-4").val(),
                "parade" : $("#id-fiche-parade-arme-4").val(),
                "portee" : $("#id-fiche-portee-arme-4").val(),
                "rupture" : $("#id-fiche-rupture-arme-4").val(),
                "bonus_malus" : $("#id-fiche-bonus-arme-4").val(),
            },
            "bouclier" : {
                "nom" : $("#id-fiche-nom-bouclier").val(),
                "type" : $("#id-fiche-type-bouclier").val(),
                "parade" : $("#id-fiche-parade-bouclier").val(),
                "pr_physique" : $("#id-fiche-pr-physique-bouclier").val(),
                "pr_magique" : $("#id-fiche-pr-magique-bouclier").val(),
                "rupture" : $("#id-fiche-rupture-bouclier").val(),
                "bonus_malus" : $("#id-fiche-bonus-bouclier").val(),
            },
            "armure" : {
                "naturelle" : {
                    "pr_physique" : $("#id-fiche-pr-phy-armure-1").val(),
                    "pr_magique" : $("#id-fiche-pr-mag-armure-1").val(),
                    "bonus_malus" : $("#id-fiche-bonus-armure-1").val(),
                },
                "tete" : {
                    "nom" : $("#id-fiche-nom-armure-2").val(),
                    "type" : $("#id-fiche-type-armure-2").val(),
                    "pr_physique" : $("#id-fiche-pr-phy-armure-2").val(),
                    "pr_magique" : $("#id-fiche-pr-mag-armure-2").val(),
                    "rupture" : $("#id-fiche-rupture-armure-2").val(),
                    "bonus_malus" : $("#id-fiche-bonus-armure-2").val(),
                },
                "torse" : {
                    "nom" : $("#id-fiche-nom-armure-3").val(),
                    "type" : $("#id-fiche-type-armure-3").val(),
                    "pr_physique" : $("#id-fiche-pr-phy-armure-3").val(),
                    "pr_magique" : $("#id-fiche-pr-mag-armure-3").val(),
                    "rupture" : $("#id-fiche-rupture-armure-3").val(),
                    "bonus_malus" : $("#id-fiche-bonus-armure-3").val(),
                },
                "bras" : {
                    "nom" : $("#id-fiche-nom-armure-4").val(),
                    "type" : $("#id-fiche-type-armure-4").val(),
                    "pr_physique" : $("#id-fiche-pr-phy-armure-4").val(),
                    "pr_magique" : $("#id-fiche-pr-mag-armure-4").val(),
                    "rupture" : $("#id-fiche-rupture-armure-4").val(),
                    "bonus_malus" : $("#id-fiche-bonus-armure-4").val(),
                },
                "jambes" : {
                    "nom" : $("#id-fiche-nom-armure-4").val(),
                    "type" : $("#id-fiche-type-armure-4").val(),
                    "pr_physique" : $("#id-fiche-pr-phy-armure-4").val(),
                    "pr_magique" : $("#id-fiche-pr-mag-armure-4").val(),
                    "rupture" : $("#id-fiche-rupture-armure-4").val(),
                    "bonus_malus" : $("#id-fiche-bonus-armure-4").val(),
                },
            },
            "objets_magique" : {
                "anneau_droit" : {
                    "nom" : $("id-fiche-nom-anneau-droit").val(),
                    "effet" : $("id-fiche-effet-anneau-droit").val(),
                },
                "anneau_gauche" : {
                    "nom" : $("id-fiche-nom-anneau-gauche").val(),
                    "effet" : $("id-fiche-effet-anneau-gauche").val(),
                },
                "anneau_collier" : {
                    "nom" : $("id-fiche-nom-collier").val(),
                    "effet" : $("id-fiche-effet-collier").val(),
                },
            },
            "bourse" : {
                "po" : $("id-fiche-po").val(),
                "pa" : $("id-fiche-pa").val(),
                "pb" : $("id-fiche-pb").val(),
            },
            "competences" : {
                "acrobatie" : $("#id-fiche-bonus-acrobatie").val(),
                "arcane" : $("#id-fiche-bonus-arcane").val(),
                "athletisme" : $("#id-fiche-bonus-athletisme").val(),
                "discretion" : $("#id-fiche-bonus-discretion").val(),
                "dressage" : $("#id-fiche-bonus-dressage").val(),
                "escamotage" : $("#id-fiche-bonus-escamotage").val(),
                "histoire" : $("#id-fiche-bonus-histoire").val(),
                "intimidation" : $("#id-fiche-bonus-intimidation").val(),
                "intuition" : $("#id-fiche-bonus-intuition").val(),
                "investigation" : $("#id-fiche-bonus-investigation").val(),
                "medecine" : $("#id-fiche-bonus-medecine").val(),
                "maitrise_arcanes" : $("#id-fiche-bonus-maitrise-arcanes").val(),
                "mysteres" : $("#id-fiche-bonus-mysteres").val(),
                "nature" : $("#id-fiche-bonus-nature").val(),
                "perception" : $("#id-fiche-bonus-perception").val(),
                "persuasion" : $("#id-fiche-bonus-persuasion").val(),
                "religion" : $("#id-fiche-bonus-religion").val(),
                "representation" : $("#id-fiche-bonus-representation").val(),
                "survie" : $("#id-fiche-bonus-survie").val(),
                "tromperie" : $("#id-fiche-bonus-tromperie").val(),
            },
            "potion" : potion_json,
            "trait" : traits_json,
            "special" : special_json,
            "sort" : sort_json
        };
    }
    save_fiche($("#id-fiche-nom").val(), JSON.stringify(fiche_json), getParameter("type_fiche"))
    
});

</script>

<style>
input, select {
    min-width: 150px;
}

textarea {
    min-width: 250px;
}

button.ita-btn-secondary-table{
    background-color:#6c757d
}

button.ita-btn-secondary-table:hover{
    background-color:#5c636a
}
button.ita-btn-danger-table{
    background-color:#dc3545
}

button.ita-btn-danger-table:hover{
    background-color:#bb2d3b
}

</style>